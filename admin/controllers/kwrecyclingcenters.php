<?php
/**
 * @package     Joomla.Administrator
 * @subpackage  com_helloworld
 *
 * @copyright   Copyright (C) 2005 - 2015 Open Source Matters, Inc. All rights reserved.
 * @license     GNU General Public License version 2 or later; see LICENSE.txt
 */
// No direct access to this file
defined('_JEXEC') or die('Restricted access');

/**
 * HelloWorlds Controller
 *
 * @since  0.0.1
 */
class KwrecyclingCenterControllerKwrecyclingCenters extends JControllerAdmin
{
	/**
	 * Proxy for getModel.
	 *
	 * @param   string  $name    The model name. Optional.
	 * @param   string  $prefix  The class prefix. Optional.
	 * @param   array   $config  Configuration array for model. Optional.
	 *
	 * @return  object  The model.
	 *
	 * @since   1.6
	 */
	public function getModel($name = 'KwrecyclingCenter', $prefix = 'KwrecyclingCenterModel', $config = array('ignore_request' => true))
	{
		$model = parent::getModel($name, $prefix, $config);

		return $model;
	}	 public function publish()    {       parent::publish();	    	} 		function export(){  		ob_end_clean();    $app = JFactory::getApplication();	/* header('Content-Encoding: UTF-8'); 	header('Content-Type: text/csv; charset=utf-8'); 	header('Content-Disposition: attachment; filename=data.csv');        $output = fopen("php://output", "w");       fputcsv($output, array('federal state', 'County town', 'Companies', 'Name', 'road' , 'Postal code' , 'place' , 'Internet','E-Mail','Monday','','','Tuesday','','','Wednesday','','','Thursday','','','Friday','','','Saturday','','','summer opening times (hours by week)','Monday','','','Tuesday','','','Wednesday','','','Thursday','','','Friday','','','Saturday','','','Winter opening times (hours by week)','Remarks','longitute','latitude'));	fputcsv($output, array('', '', '', '', '' , '' , '' , '','','From','To','duration','From','To','duration','From','To','duration','From','To','duration','From','To','duration','From','To','duration','','From','To','duration','From','To','duration','From','To','duration','From','To','duration','From','To','duration','From','To','duration','','','','')); */	 $filename = "recycling-center.xls";                   header("Content-Type: application/vnd.ms-excel");            header("Content-Disposition: attachment; filename=\"$filename\"");			$header1=array('federal state', 'County town', 'Companies', 'Name', 'road' , 'Postal code' , 'place' , 'Internet','E-Mail','Monday','','','Tuesday','','','Wednesday','','','Thursday','','','Friday','','','Saturday','','','summer opening times (hours by week)','Monday','','','Tuesday','','','Wednesday','','','Thursday','','','Friday','','','Saturday','','','Winter opening times (hours by week)','Remarks','longitute','latitude');			$header2=array('', '', '', '', '' , '' , '' , '','','From','To','duration','From','To','duration','From','To','duration','From','To','duration','From','To','duration','From','To','duration','','From','To','duration','From','To','duration','From','To','duration','From','To','duration','From','To','duration','From','To','duration','','','','');			echo implode("\t", array_values($header1)) . "\n";			echo implode("\t", array_values($header2)) . "\n";	$app  = JFactory::getApplication();			$db = JFactory::getDbo();		$query = $db->getQuery(true);		$query->select($db->quoteName(array('id','federal_state','town','companies','name','road', 'postal_code','place','internet', 'email', 'remarks','longitute', 'latitude')));		$query->from($db->quoteName('#__kwrecyclingcenter'));		$db->setQuery($query);		$center_data = $db->loadObjectList(); 		foreach($center_data as $data){		$query = $db->getQuery(true);		$query->select($db->quoteName(array('SOTfromtime','SOTtotime','SOTduration','SOTweekday')));		$query->from($db->quoteName('#__kwrecyclingSOT'));		$conditions = array(    $db->quoteName('SOTrecycling_id') . ' = '.$data->id);		$query->where($conditions);		$db->setQuery($query);		$sumeropeningtime = $db->loadObjectList();		$query = $db->getQuery(true);		$query->select($db->quoteName(array('WOTfromtime','WOTtotime','WOTduration','WOTweekday')));	$query->from($db->quoteName('#__kwrecyclingWOT'));			$conditions = array(    $db->quoteName('WOTrecycling_id') . ' = '.$data->id);		$query->where($conditions);		$db->setQuery($query);		$winteropeningtime = $db->loadObjectList();			$mon_sum_to = $mon_sum_from = $mon_sum_duration  = '';		$tue_sum_to = $tue_sum_from = $tue_sum_duration  = '';		$wed_sum_to = $wed_sum_from = $wed_sum_duration  = '';		$thu_sum_to = $thu_sum_from = $thu_sum_duration  = '';		$fri_sum_to = $fri_sum_from = $fri_sum_duration  = '';		$sat_sum_to = $sat_sum_from = $sat_sum_duration  = '';		foreach($sumeropeningtime as $summertime){		if($summertime->SOTweekday == 1){		$mon_sum_to = $summertime->SOTtotime;		$mon_sum_from = $summertime->SOTfromtime;			$mon_sum_duration  = $summertime->SOTduration;		}			if($summertime->SOTweekday == 2){		$tue_sum_to = $summertime->SOTtotime;				$tue_sum_from = $summertime->SOTfromtime;			$tue_sum_duration  = $summertime->SOTduration;			}			if($summertime->SOTweekday == 3){		$wed_sum_to = $summertime->SOTtotime;				$wed_sum_from = $summertime->SOTfromtime;			$wed_sum_duration  = $summertime->SOTduration;		}			if($summertime->SOTweekday == 4){		$thu_sum_to = $summertime->SOTtotime;				$thu_sum_from = $summertime->SOTfromtime;			$thu_sum_duration  = $summertime->SOTduration;		}			if($summertime->SOTweekday == 5){		$fri_sum_to = $summertime->SOTtotime;				$fri_sum_from = $summertime->SOTfromtime;			$fri_sum_duration  = $summertime->SOTduration;		}			if($summertime->SOTweekday == 6){		$sat_sum_to = $summertime->SOTtotime;				$sat_sum_from = $summertime->SOTfromtime;		$sat_sum_duration  = $summertime->SOTduration;		}		} 		$mon_win_to = $mon_win_from = $mon_win_duration  = '';		$tue_win_to = $tue_win_from = $tue_win_duration  = '';		$wed_win_to = $wed_win_from = $wed_win_duration  = '';		$thu_win_to = $thu_win_from = $thu_win_duration  = '';		$fri_win_to = $fri_win_from = $fri_win_duration  = '';		$sat_win_to = $sat_win_from = $sat_win_duration  = '';		foreach($winteropeningtime as $wintertime){			if($wintertime->WOTweekday == 1){		$mon_win_to = $wintertime->WOTtotime;			$mon_win_from = $wintertime->WOTfromtime;			$mon_win_duration  = $wintertime->WOTduration;		}			if($wintertime->WOTweekday == 2){		$tue_win_to = $wintertime->WOTtotime;				$tue_win_from = $wintertime->WOTfromtime;			$tue_win_duration  = $wintertime->WOTduration;			}			if($wintertime->WOTweekday == 3){		$wed_win_to = $wintertime->WOTtotime;				$wed_win_from = $wintertime->WOTfromtime;			$wed_win_duration  = $wintertime->WOTduration;		}			if($wintertime->WOTweekday == 4){		$thu_win_to = $wintertime->WOTtotime;				$thu_win_from = $wintertime->WOTfromtime;			$thu_win_duration  = $wintertime->WOTduration;		}			if($wintertime->WOTweekday == 5){		$fri_win_to = $wintertime->WOTtotime;				$fri_win_from = $wintertime->WOTfromtime;			$fri_win_duration  = $wintertime->WOTduration;		}			if($wintertime->WOTweekday == 6){		$sat_win_to = $wintertime->WOTtotime;				$sat_win_from = $wintertime->WOTfromtime;			$sat_win_duration  = $wintertime->WOTduration;		}		}	$csvData = array($data->federal_state,$data->town,$data->companies,$data->name,$data->road,$data->postal_code,$data->place,$data->internet,$data->email,$mon_sum_from,$mon_sum_to,$mon_sum_duration,$tue_sum_from,$tue_sum_to,$tue_sum_duration,$wed_sum_from,$wed_sum_to,$wed_sum_duration,$thu_sum_from,$thu_sum_to,$thu_sum_duration,$fri_sum_from,$fri_sum_to,$fri_sum_duration,$sat_sum_from,$sat_sum_to,$sat_sum_duration,'',$mon_win_from,$mon_win_to,$mon_win_duration,$tue_win_from,$tue_win_to,$tue_win_duration,$wed_win_from,$wed_win_to,$wed_win_duration,$thu_win_from,$thu_win_to,$thu_win_duration,$fri_win_from,$fri_win_to,$fri_win_duration,$sat_win_from,$sat_win_to,$sat_win_duration,'',$data->remarks,$data->longitute,$data->latitude);	$csv_array = array_map("utf8_decode", $csvData);		echo implode("\t", array_values($csv_array)) . "\n";	/* fputcsv($output, $csv_array); */		}	/* 	fclose($output);  */    $app->close();}
}
